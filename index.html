<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMA V.2 - AI Sale Assistant (Enhanced)</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', 'Noto Sans Thai', sans-serif;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
        }
        
        .animate-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .slide-in-from-bottom {
            animation: slideInFromBottom 0.5s ease-out;
        }
        
        @keyframes slideInFromBottom {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .markdown-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #0f172a;
        }
        
        .markdown-content ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .markdown-content li {
            margin-bottom: 0.5rem;
        }
        
        .markdown-content strong {
            font-weight: 700;
            color: #0f172a;
        }
        
        /* Popup styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .popup-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 768px) {
            .mobile-fix {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                overflow: hidden;
            }
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root" class="min-h-screen"></div>
    
    <!-- Popup for Non-AI system warning -->
    <div id="non-ai-popup" class="popup-overlay hidden">
        <div class="popup-content">
            <h3 class="text-lg font-bold text-slate-800 mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ AI</h3>
            <p class="text-slate-600 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ AI ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
            <div class="flex gap-3 justify-end">
                <button onclick="app.hideNonAIPopup()" class="px-4 py-2 text-slate-600 hover:text-slate-800 font-medium">
                    Cancel
                </button>
                <button onclick="app.goToNonAISystem()" class="px-4 py-2 bg-gradient-to-r from-sky-600 to-indigo-600 text-white font-bold rounded-lg hover:from-sky-700 hover:to-indigo-700">
                    Ok! Let's go
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans Thai', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#0ea5e9',
                        'secondary': '#6366f1',
                    }
                }
            }
        };

        // --- Enhanced Regional Data Schema ---
        const RH_DATA = {
            "RH1": {
                name: "RH1: ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø & ‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•",
                zones: ["‡∏à‡∏ï‡∏∏‡∏à‡∏±‡∏Å‡∏£", "‡∏ò‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ö‡∏≤‡∏á‡∏Å‡∏∞‡∏õ‡∏¥", "‡∏™‡∏≤‡∏ó‡∏£", "‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó"],
                dynamics: "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡πÄ‡∏£‡πà‡∏á‡∏£‡∏µ‡∏ö ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏û‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
                keywords: ["‡∏†‡∏≤‡∏©‡∏µ‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°", "‡∏°‡∏£‡∏î‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"],
                hospitals: ["‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå", "‡∏™‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏ä ‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û", "‡∏û‡∏ç‡∏≤‡πÑ‡∏ó 2"],
                tone: "Professional, ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö, ‡πÄ‡∏ô‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏µ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô ‡∏£‡∏û. ‡∏£‡∏∞‡∏î‡∏±‡∏ö World Class"
            },
            "RH2": {
                name: "RH2: ‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å (EEC)",
                zones: ["‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ö‡∏≤‡∏á‡∏ô‡∏≤", "‡∏û‡∏±‡∏ó‡∏¢‡∏≤", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á"],
                dynamics: "‡πÄ‡∏Ç‡∏ï‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà ‡∏ô‡∏¥‡∏Ñ‡∏°‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏° ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á",
                keywords: ["‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", "‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÑ‡∏ß", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏û‡∏±‡∏ó‡∏¢‡∏≤", "‡∏™‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏ä ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤", "‡∏û‡∏ç‡∏≤‡πÑ‡∏ó ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤"],
                tone: "‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à, ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤, ‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô"
            },
            "RH3": {
                name: "RH3: ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
                zones: ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤"],
                dynamics: "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤ ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°",
                keywords: ["‡∏ö‡∏≤‡∏£‡∏°‡∏µ", "‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô", "‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏á‡πà‡∏≤‡∏á‡∏≤‡∏°", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢"],
                hospitals: ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏≤‡∏°", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏®‡∏£‡∏µ‡∏û‡∏±‡∏í‡∏ô‡πå"],
                tone: "‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•, ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥, ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏£‡∏î‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏ß‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏£‡∏∞‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"
            },
            "RH4": {
                name: "RH4: ‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
                zones: ["‡∏î‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"],
                dynamics: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ç‡∏¢‡∏≤‡∏¢ ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç",
                keywords: ["‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ï‡∏±‡∏ç‡∏ç‡∏π", "‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ", "‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏•‡∏π‡∏Å", "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏£‡∏∞‡πÉ‡∏Ñ‡∏£"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡πÄ‡∏≠‡∏Å‡∏≠‡∏∏‡∏î‡∏£", "‡∏û‡∏£‡∏¥‡πâ‡∏ô‡∏ã‡πå ‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"],
                tone: "‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á, ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥, ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏á‡πà‡∏≤‡∏¢",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å"
            },
            "RH5": {
                name: "RH5: ‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ",
                zones: ["‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà"],
                dynamics: "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏á/‡∏™‡∏ß‡∏ô‡∏¢‡∏≤‡∏á/‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤",
                keywords: ["‡πÉ‡∏à‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏á", "‡∏û‡∏ß‡∏Å‡∏û‡πâ‡∏≠‡∏á", "‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á", "‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå (SMC)"],
                tone: "‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏ô‡πà‡∏ô, ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô, ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à, ‡πÑ‡∏°‡πà‡πÄ‡∏¢‡∏¥‡πà‡∏ô‡πÄ‡∏¢‡πâ‡∏≠",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≥‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠"
            }
        };

        // Icon mapping
        const ICONS = {
            calculator: '<i class="fas fa-calculator text-sky-500"></i>',
            message: '<i class="fas fa-comment-dots text-indigo-500"></i>',
            shield: '<i class="fas fa-shield-alt text-amber-500"></i>',
            gift: '<i class="fas fa-gift text-emerald-500"></i>',
            bag: '<i class="fas fa-shopping-bag text-purple-500"></i>',
            file: '<i class="fas fa-file-check text-emerald-500"></i>',
            terminal: '<i class="fas fa-terminal text-slate-500"></i>',
            sparkles: '<i class="fas fa-sparkles text-amber-500"></i>',
            map: '<i class="fas fa-map-marker-alt text-rose-500"></i>',
            alert: '<i class="fas fa-exclamation-circle text-rose-500"></i>',
            building: '<i class="fas fa-building text-sky-500"></i>',
            stethoscope: '<i class="fas fa-stethoscope text-purple-500"></i>',
            lightbulb: '<i class="fas fa-lightbulb text-amber-500"></i>',
            zap: '<i class="fas fa-bolt text-amber-500"></i>',
            trending: '<i class="fas fa-chart-line text-emerald-500"></i>',
            copy: '<i class="fas fa-copy text-slate-500"></i>',
            rotate: '<i class="fas fa-redo text-slate-500"></i>',
            thumbsUp: '<i class="fas fa-thumbs-up text-emerald-500"></i>',
            thumbsDown: '<i class="fas fa-thumbs-down text-rose-500"></i>',
            share: '<i class="fas fa-share-alt text-sky-500"></i>',
            save: '<i class="fas fa-save text-sky-500"></i>',
            chevronRight: '<i class="fas fa-chevron-right"></i>',
            users: '<i class="fas fa-users text-sky-500"></i>',
            heart: '<i class="fas fa-heart text-rose-500"></i>',
            loader: '<i class="fas fa-spinner fa-spin"></i>',
            home: '<i class="fas fa-home text-sky-500"></i>',
            briefcase: '<i class="fas fa-briefcase text-amber-500"></i>',
            money: '<i class="fas fa-money-bill-wave text-emerald-500"></i>',
            hospital: '<i class="fas fa-hospital text-rose-500"></i>',
            clock: '<i class="fas fa-clock text-amber-500"></i>',
            chartPie: '<i class="fas fa-chart-pie text-purple-500"></i>'
        };

        // --- Supabase Configuration ---
        const SUPABASE_CONFIG = {
            url: 'https://wmgrfwvlrdbfmqngtuuq.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndtZ3Jmd3ZscmRiZm1xbmd0dXVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1NTU4MjYsImV4cCI6MjA4NTEzMTgyNn0.l-VMPuCfL69hcHAyd3Nw3pi1HUPlGV2Iz7AuTEO2sU4'
        };

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);

        // API Key Rotation Function
        const getRotatedApiKey = async () => {
            try {
                const { data, error } = await supabase
                    .from('api_keys')
                    .select('key, usage_count, last_used')
                    .eq('status', 'active')
                    .order('last_used', { ascending: true })
                    .limit(1);
                
                if (error) throw error;
                
                if (data && data.length > 0) {
                    // Update usage count
                    await supabase
                        .from('api_keys')
                        .update({ 
                            usage_count: data[0].usage_count + 1,
                            last_used: new Date().toISOString()
                        })
                        .eq('key', data[0].key);
                    
                    return data[0].key;
                }
                return null;
            } catch (error) {
                console.error('Supabase error:', error);
                return null;
            }
        };

        // --- Enhanced MAMA V.2 Application ---
        class MAMAV2Enhanced {
            constructor() {
                this.state = {
                    currentApiKey: "",
                    isSetup: false,
                    userProfile: { rh: "", zone: "" },
                    activeTab: "ice_breaking", // Start with Ice Breaking as per requirements
                    loading: false,
                    aiResponse: "",
                    error: "",
                    feedback: null,
                    forms: {
                        ice_breaking: {
                            transaction: "",
                            insight: "",
                            disc: "D",
                            relationship_level: "",
                            common_interest: ""
                        },
                        needs_analysis: {
                            income: "",
                            tax_bracket: "10%",
                            welfare: "",
                            top_concern: "",
                            dependents: "",
                            years: "",
                            assets: "",
                            debt: ""
                        },
                        objection: {
                            real_reason: "",
                            interest_level: "5",
                            disc: "D",
                            product: "",
                            tone: ""
                        },
                        simplifier: {
                            plan_name: "",
                            benefits: "",
                            premium: "",
                            competitor_comparison: "",
                            unique_selling_point: ""
                        },
                        matchmaker: {
                            goal: "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ",
                            budget: "",
                            existing_coverage: "",
                            priority_level: ""
                        },
                        closing: {
                            interest_point: "",
                            last_concern: "",
                            timeline: "",
                            decision_maker: ""
                        },
                        prompt_designer: {
                            objective: "",
                            target: "",
                            tone: "Professional",
                            details: "",
                            channel: "",
                            call_to_action: ""
                        }
                    }
                };
                
                this.init();
            }
            
            setState(newState) {
                for (let key in newState) {
                    if (typeof this.state[key] === 'object' && this.state[key] !== null && !Array.isArray(this.state[key])) {
                        this.state[key] = { ...this.state[key], ...newState[key] };
                    } else {
                        this.state[key] = newState[key];
                    }
                }
                this.render();
            }
            
            handleInputChange(tab, field, value) {
                this.state.forms[tab][field] = value;
                
                // Update specific input element if it exists
                const inputId = `${tab}-${field}`;
                const element = document.getElementById(inputId);
                if (element) {
                    element.value = value;
                }
            }
            
            calculateProtectionGap() {
                const f = this.state.forms.needs_analysis;
                const income = parseFloat(f.income) || 0;
                const debt = parseFloat(f.debt) || 0;
                const dependents = parseInt(f.dependents) || 0;
                const years = parseInt(f.years) || 5;
                const assets = parseFloat(f.assets) || 0;
                
                // Simple protection gap calculation
                const monthlyNeed = (income * 0.7) / 12; // 70% of income
                const totalNeed = debt + (monthlyNeed * 12 * years);
                const gap = Math.max(0, totalNeed - assets);
                
                return gap;
            }
            
            showNonAIPopup() {
                const popup = document.getElementById('non-ai-popup');
                if (popup) {
                    popup.classList.remove('hidden');
                }
            }
            
            hideNonAIPopup() {
                const popup = document.getElementById('non-ai-popup');
                if (popup) {
                    popup.classList.add('hidden');
                }
            }
            
            goToNonAISystem() {
                window.location.href = "https://pltpdttb-jpg.github.io/sales-assist/";
            }
            
            async getApiKey() {
                // Try to get rotated API key from Supabase
                const rotatedKey = await getRotatedApiKey();
                if (rotatedKey) {
                    return rotatedKey;
                }
                
                // Fallback to stored key or demo mode
                return this.state.currentApiKey;
            }
            
            getEnhancedPrompt() {
                const rh = RH_DATA[this.state.userProfile.rh] || {};
                const zone = this.state.userProfile.zone || "";
                const forms = this.state.forms;
                
                const commonContext = `Context: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ AI Assistant (MAMA V.2) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone} (${rh.name || ""}). 
                Local Dynamics: ${rh.dynamics || ""}. 
                Local Keywords: ${rh.keywords ? rh.keywords.join(", ") : ""}.
                Top Hospitals: ${rh.hospitals ? rh.hospitals.join(", ") : ""}.`;
                
                switch (this.state.activeTab) {
                    case "ice_breaking":
                        return `
Role: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á (Master Communication Psychologist) ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÉ‡∏ô‡∏ó‡∏§‡∏©‡∏é‡∏µ Contextual Bridging ‡πÅ‡∏•‡∏∞ DISC Profiling
${commonContext}

Client Context:
- ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${forms.ice_breaking.transaction}
- ‡∏™‡∏¥‡πà‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å: ${forms.ice_breaking.insight}
- ‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (DISC): ${forms.ice_breaking.disc}
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå: ${forms.ice_breaking.relationship_level}
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏°: ${forms.ice_breaking.common_interest}

Task: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á "‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå" ‡∏à‡∏≤‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏•‡∏∂‡∏Å‡πÜ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢

Deep Instruction:
1. [Contextual Bridge Mapping]: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå "‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á" ‡πÅ‡∏•‡∏∞ "‡∏™‡∏¥‡πà‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ Hidden Concern ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á
2. [DISC-Optimized Approach]: ‡∏õ‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
3. [Non-Sales Empathy Frame]: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢‡∏ï‡∏≤‡∏°‡∏ö‡∏£‡∏¥‡∏ö‡∏ó

Constraint:
- ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡πÅ‡∏£‡∏Å
- ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤ "‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà "‡∏ñ‡∏π‡∏Å‡∏Ç‡∏≤‡∏¢"
- ‡∏ù‡∏±‡∏á Keyword ‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${rh.keywords ? rh.keywords.join(", ") : ""} ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥

Output Format:
### üß† ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (DISC: ${forms.ice_breaking.disc})
- **‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•:** [2-3 ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏ï‡∏ô‡∏µ‡πâ]
- **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á:** [1-2 ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏ï‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏•‡∏µ‡∏¢‡∏î]

### üí¨ ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à (Contextual Bridge)
1. **Opening Hook:** [‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°/‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï]
2. **Empathy Bridge:** [‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏•‡∏∂‡∏Å‡πÜ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤]
3. **Open Question:** [‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏ö‡∏ó]

### üéØ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á (Power Question)
"[‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏¥‡∏î]"
`;

                    case "needs_analysis":
                        const gap = this.calculateProtectionGap();
                        return `
Role: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Senior Financial Risk Auditor ‡∏£‡∏∞‡∏î‡∏±‡∏ö CFP ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç Human Economic Value Calculation
${commonContext}

Client Context:
- ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ: ${forms.needs_analysis.income} ‡∏ö‡∏≤‡∏ó
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏µ: ${forms.needs_analysis.tax_bracket}
- ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${forms.needs_analysis.welfare}
- ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á: ${forms.needs_analysis.top_concern}
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏∞: ${forms.needs_analysis.dependents}
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•: ${forms.needs_analysis.years}
- ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ: ${forms.needs_analysis.assets} ‡∏ö‡∏≤‡∏ó
- ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô: ${forms.needs_analysis.debt} ‡∏ö‡∏≤‡∏ó

Task: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå "Human Economic Value" ‡πÅ‡∏•‡∏∞ "Protection Gap" ‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡∏§‡∏©‡∏é‡∏µ 3 Fears (‡πÄ‡∏à‡πá‡∏ö-‡∏à‡∏ô-‡∏ï‡∏≤‡∏¢)

Deep Instruction:
1. [Human Economic Value Calculation]: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß
2. [3 Fears Analysis]: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏°‡∏£‡∏î‡∏Å
3. [Protection Gap Visualization]: ‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone}

Constraint:
- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏π‡∏î‡∏•‡∏≠‡∏¢‡πÜ
- ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏¢‡∏≤‡∏Å)
- ‡πÄ‡∏ô‡πâ‡∏ô "‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ç‡πÄ‡∏™‡∏µ‡∏¢" ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ "‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÑ‡∏î‡πâ"

Output Format:
### üö® ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk Audit Report)
- **üí∞ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:** [‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç + ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢]
- **üè• ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:** [‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤ + ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà]
- **üìâ ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ:** [‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô]
- **üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏°‡∏£‡∏î‡∏Å:** [‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà]

### üéØ ‡πÅ‡∏ú‡∏ô‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
1. **First Priority:** [‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå] - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ [‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå]
2. **Second Priority:** [‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå] - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ [‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤]
3. **Third Priority:** [‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå] - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ [‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏±‡∏á‡∏Ñ‡∏°]
`;

                    case "objection":
                        return `
Role: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Master Negotiator ‡πÅ‡∏•‡∏∞ Emotional Reframing Specialist
${commonContext}

Client Context:
- ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏à‡∏£‡∏¥‡∏á: ${forms.objection.real_reason}
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏î‡∏¥‡∏°: ${forms.objection.interest_level}/10
- ‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${forms.objection.disc}
- ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠: ${forms.objection.product}
- ‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${forms.objection.tone}

Task: ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Reframing & Empathy ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏à‡∏≤‡∏Å "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢" ‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á"

Deep Instruction:
1. [Root Cause Analysis]: ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà
2. [Feel-Felt-Found Technique]: ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô
3. [Value Reframing Matrix]: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô
4. [DISC-Specific Closing]: ‡∏õ‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏ï

Constraint:
- ‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏™‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á)
- ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏ö‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö Interest Level (1-10)
- ‡∏´‡πâ‡∏≤‡∏°‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á‡∏ï‡∏£‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏ó‡∏ô

Output Format:
### üéØ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
- **Root Cause:** [‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà]
- **Emotional Trigger:** [‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò]

### üí° ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Feel-Felt-Found ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö${zone}
1. **Feel (‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à):** "[‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà]"
2. **Felt (‡πÄ‡∏Ñ‡∏¢‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å):** "[‡∏¢‡∏Å‡πÄ‡∏Ñ‡∏™‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á]"
3. **Found (‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£):** "[‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö]"

### üîÑ ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ Reframing
- **Reframe 1:** [‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤]
- **Reframe 2:** [‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ñ‡∏µ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà]
- **Closing Question:** "[‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò]"
`;

                    default:
                        return commonContext;
                }
            }
            
            async handleGenerate() {
                this.setState({ loading: true, aiResponse: "", error: "" });
                
                try {
                    // Get API key from Supabase rotation
                    const apiKey = await this.getApiKey();
                    const prompt = this.getEnhancedPrompt();
                    
                    console.log("Enhanced Prompt:", prompt);
                    
                    if (!apiKey) {
                        // Demo mode - use mock responses
                        setTimeout(() => {
                            this.showMockResponse();
                        }, 1000);
                        return;
                    }
                    
                    // Use Gemini API
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 2048,
                            }
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message || "API Error");
                    }
                    
                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å AI";
                    this.setState({ aiResponse: aiText, loading: false });
                    
                } catch (err) {
                    console.error("Error:", err);
                    this.showMockResponse();
                }
            }
            
            showMockResponse() {
                const mockResponses = {
                    ice_breaking: `### üß† ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (DISC: ${this.state.forms.ice_breaking.disc})
- **‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•:** 
  1. ‡∏û‡∏π‡∏î‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô ‡πÄ‡∏ô‡πâ‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
  2. ‡πÉ‡∏´‡πâ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÑ‡∏î‡πâ
  3. ‡πÄ‡∏Ñ‡∏≤‡∏£‡∏û‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡πá‡∏ß
- **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á:**
  - ‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡πÄ‡∏¢‡∏¥‡∏ô‡πÄ‡∏¢‡πâ‡∏≠ ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô
  - ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏î‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

### üí¨ ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à (Contextual Bridge)
1. **Opening Hook:** "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤${this.state.forms.ice_breaking.transaction || "‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°"} ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏ú‡∏°‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì${this.state.forms.ice_breaking.insight || "‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏î‡∏µ"} ‡πÄ‡∏•‡∏¢‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"
2. **Empathy Bridge:** "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ô‡πÉ‡∏ô${this.state.userProfile.zone} ‡∏ó‡∏µ‡πà‡∏°‡∏≤${this.state.forms.ice_breaking.transaction || "‡∏ó‡∏≥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°"} ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô ‡∏ú‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡πÑ‡∏ß‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"
3. **Open Question:** "‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ 100% ‡πÉ‡∏ô‡∏õ‡∏µ‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞?"

### üéØ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á (Power Question)
"‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ 1 ‡∏õ‡∏µ ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á?"`,
                    
                    needs_analysis: `### üö® ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (Risk Audit Report)
- **üí∞ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:** ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${(parseFloat(this.state.forms.needs_analysis.income) || 0) * 10 / 1000000} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó (‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ 10 ‡∏õ‡∏µ)
- **üè• ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:** ‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ó‡∏µ‡πà${RH_DATA[this.state.userProfile.rh]?.hospitals?.[0] || "‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≥"} ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 500,000 ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£${this.state.forms.needs_analysis.welfare || "‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"} ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á
- **üìâ ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ:** ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏à‡∏∞‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${Math.round((parseFloat(this.state.forms.needs_analysis.assets) || 0) / ((parseFloat(this.state.forms.needs_analysis.income) || 1) * 0.7 / 12))} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
- **üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏°‡∏£‡∏î‡∏Å:** ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô ${(parseFloat(this.state.forms.needs_analysis.debt) || 0).toLocaleString()} ‡∏ö‡∏≤‡∏ó + ‡∏Ñ‡πà‡∏≤‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏î‡∏π‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏µ‡∏Å ${(parseInt(this.state.forms.needs_analysis.dependents) || 0) * 10000 * 12 * (parseInt(this.state.forms.needs_analysis.years) || 5)} ‡∏ö‡∏≤‡∏ó

### üéØ ‡πÅ‡∏ú‡∏ô‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
1. **First Priority:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
2. **Second Priority:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ‡πÑ‡∏î‡πâ
3. **Third Priority:** ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì - ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏ô‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô`,
                    
                    objection: `### üéØ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
- **Root Cause:** ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢" ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á"
- **Emotional Trigger:** ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÉ‡∏ô‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô

### üí° ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Feel-Felt-Found ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö${this.state.userProfile.zone}
1. **Feel (‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à):** "‡∏ú‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô${this.state.userProfile.zone} ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô ‡∏ó‡∏∏‡∏Å‡∏ö‡∏≤‡∏ó‡∏ó‡∏∏‡∏Å‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏´‡∏°‡∏î"
2. **Felt (‡πÄ‡∏Ñ‡∏¢‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å):** "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡∏£‡∏¥‡∏°‡∏´‡∏≤‡∏î${this.state.userProfile.zone.includes("‡∏û‡∏±‡∏ó‡∏¢‡∏≤") ? "‡∏û‡∏±‡∏ó‡∏¢‡∏≤" : "‡πÉ‡∏Å‡∏•‡πâ‡πÜ"} ‡∏Å‡πá‡πÄ‡∏Ñ‡∏¢‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡πÄ‡∏Ç‡∏≤‡∏Å‡πá‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°"
3. **Found (‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£):** "‡πÅ‡∏ï‡πà‡∏û‡∏≠‡πÑ‡∏î‡πâ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô ‡πÄ‡∏Ç‡∏≤‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡πÅ‡∏ü‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏Å‡πâ‡∏ß ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏≤‡∏™‡∏∞‡∏™‡∏°‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÑ‡∏î‡πâ"

### üîÑ ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ Reframing
- **Reframe 1:** "‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"
- **Reframe 2:** "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠ '‡πÄ‡∏ß‡∏•‡∏≤' ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏û‡∏±‡∏Å‡∏ü‡∏∑‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô"
- **Closing Question:** "‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 30 ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡πÄ‡∏á‡∏¥‡∏ô 3 ‡πÅ‡∏™‡∏ô‡∏ö‡∏≤‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏ù‡∏±‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏´‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö?"`
                };
                
                this.setState({ 
                    aiResponse: mockResponses[this.state.activeTab] || "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...", 
                    loading: false 
                });
            }
            
            renderInputSection() {
                const tab = this.state.activeTab;
                const f = this.state.forms[tab];
                
                const createInput = (tabName, field, value, placeholder, type = "text", extraClass = "") => {
                    return `
                        <input 
                            id="${tabName}-${field}"
                            type="${type}" 
                            class="w-full p-3 border border-slate-200 rounded-xl bg-white text-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-200 outline-none transition-all ${extraClass}"
                            value="${value || ''}"
                            oninput="app.handleInputChange('${tabName}', '${field}', this.value)"
                            placeholder="${placeholder}"
                            autocomplete="off"
                        >
                    `;
                };
                
                const createTextarea = (tabName, field, value, placeholder, rows = 4) => {
                    return `
                        <textarea 
                            id="${tabName}-${field}"
                            class="w-full p-3 border border-slate-200 rounded-xl bg-white text-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-200 outline-none transition-all resize-none"
                            rows="${rows}"
                            oninput="app.handleInputChange('${tabName}', '${field}', this.value)"
                            placeholder="${placeholder}"
                            autocomplete="off"
                        >${value || ''}</textarea>
                    `;
                };
                
                const createSelect = (tabName, field, value, options, placeholder = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å") => {
                    let optionsHtml = `<option value="">${placeholder}</option>`;
                    
                    if (Array.isArray(options)) {
                        options.forEach(option => {
                            const isSelected = option === value ? 'selected' : '';
                            optionsHtml += `<option value="${option}" ${isSelected}>${option}</option>`;
                        });
                    } else if (typeof options === 'object') {
                        Object.entries(options).forEach(([key, label]) => {
                            const isSelected = key === value ? 'selected' : '';
                            optionsHtml += `<option value="${key}" ${isSelected}>${label}</option>`;
                        });
                    }
                    
                    return `
                        <select 
                            id="${tabName}-${field}"
                            class="w-full p-3 border border-slate-200 rounded-xl bg-white text-sm focus:border-sky-500 focus:ring-2 focus:ring-sky-200 outline-none transition-all"
                            onchange="app.handleInputChange('${tabName}', '${field}', this.value)"
                        >
                            ${optionsHtml}
                        </select>
                    `;
                };
                
                const InputWrap = (label, children) => `
                    <div class="mb-5">
                        <label class="block text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">${label}</label>
                        ${children}
                    </div>
                `;
                
                switch (tab) {
                    case "ice_breaking":
                        const transactionOptions = ["‡∏ù‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "‡∏°‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏∏‡∏î", "‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏≠‡∏ô", "‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏¥‡∏ï‡∏¥‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"];
                        const discOptions = {
                            "D": "D - ‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Direct)",
                            "I": "I - ‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏¢ (Influential)",
                            "S": "S - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á (Steady)",
                            "C": "C - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Conscientious)"
                        };
                        const relationshipOptions = ["‡πÉ‡∏´‡∏°‡πà", "‡∏û‡∏≠‡∏Ñ‡∏∏‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢", "‡∏™‡∏ô‡∏¥‡∏ó"];
                        
                        return `
                            <div class="space-y-4 animate-in">
                                ${InputWrap("‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á", 
                                    createSelect('ice_breaking', 'transaction', f.transaction, transactionOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°")
                                )}
                                ${InputWrap("‡∏™‡∏¥‡πà‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å (Insight)", 
                                    createTextarea('ice_breaking', 'insight', f.insight, "‡πÄ‡∏ä‡πà‡∏ô: ‡∏°‡∏≤‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡πÄ‡∏•‡πá‡∏Å, ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏´‡πà‡∏ß‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏´‡∏ß, ‡πÉ‡∏™‡πà‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£...", 3)
                                )}
                                <div class="grid grid-cols-2 gap-4">
                                    ${InputWrap("‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (DISC)", 
                                        createSelect('ice_breaking', 'disc', f.disc, discOptions)
                                    )}
                                    ${InputWrap("‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå", 
                                        createSelect('ice_breaking', 'relationship_level', f.relationship_level, relationshipOptions)
                                    )}
                                </div>
                                ${InputWrap("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏° (‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ)", 
                                    createInput('ice_breaking', 'common_interest', f.common_interest, "‡πÄ‡∏ä‡πà‡∏ô: ‡∏Å‡∏≠‡∏•‡πå‡∏ü, ‡∏•‡∏á‡∏ó‡∏∏‡∏ô, ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß")
                                )}
                            </div>
                        `;
                    
                    case "needs_analysis":
                        const taxOptions = ["10%", "20%", "30%", "‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏•‡∏¢"];
                        const welfareOptions = ["‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏≠‡∏á/‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó", "‡∏°‡∏µ‡πÄ‡∏•‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß", "‡πÑ‡∏°‡πà‡∏°‡∏µ"];
                        const concernOptions = ["‡∏Å‡∏•‡∏±‡∏ß‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏¢", "‡∏Å‡∏•‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡∏±‡∏á‡πÅ‡∏ï‡∏Å", "‡∏Å‡∏•‡∏±‡∏ß‡∏•‡∏π‡∏Å‡∏•‡∏≥‡∏ö‡∏≤‡∏Å‡∏ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"];
                        
                        return `
                            <div class="space-y-4 animate-in">
                                ${InputWrap("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)", 
                                    createInput('needs_analysis', 'income', f.income, "‡πÄ‡∏ä‡πà‡∏ô: 600000", "number")
                                )}
                                <div class="grid grid-cols-2 gap-4">
                                    ${InputWrap("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≤‡∏á‡∏†‡∏≤‡∏©‡∏µ", 
                                        createSelect('needs_analysis', 'tax_bracket', f.tax_bracket, taxOptions)
                                    )}
                                    ${InputWrap("‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏∞", 
                                        createInput('needs_analysis', 'dependents', f.dependents, "‡∏Ñ‡∏ô", "number")
                                    )}
                                </div>
                                ${InputWrap("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô", 
                                    createSelect('needs_analysis', 'welfare', f.welfare, welfareOptions)
                                )}
                                ${InputWrap("‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏´‡∏ô‡∏∂‡πà‡∏á", 
                                    createSelect('needs_analysis', 'top_concern', f.top_concern, concernOptions)
                                )}
                                <div class="grid grid-cols-2 gap-4">
                                    ${InputWrap("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•", 
                                        createInput('needs_analysis', 'years', f.years, "‡∏õ‡∏µ", "number")
                                    )}
                                    ${InputWrap("‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ", 
                                        createInput('needs_analysis', 'assets', f.assets, "‡∏ö‡∏≤‡∏ó", "number")
                                    )}
                                </div>
                                ${InputWrap("‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏°", 
                                    createInput('needs_analysis', 'debt', f.debt, "‡∏ö‡∏≤‡∏ó", "number")
                                )}
                                <div class="mt-6 p-4 bg-gradient-to-r from-sky-50 to-indigo-50 rounded-xl border border-sky-100">
                                    <div class="flex items-center gap-2 mb-2">
                                        ${ICONS.alert}
                                        <span class="text-sm font-bold text-sky-800">Protection Gap</span>
                                    </div>
                                    <div class="text-2xl font-black text-sky-900">${this.calculateProtectionGap().toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                    <p class="text-xs text-sky-600 mt-1">‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô</p>
                                </div>
                            </div>
                        `;
                    
                    case "objection":
                        const reasonOptions = ["‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á", "‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô", "‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ó‡∏¥‡πâ‡∏á‡∏™‡∏π‡∏ç‡πÄ‡∏õ‡∏•‡πà‡∏≤", "‡∏Ç‡∏≠‡πÑ‡∏õ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"];
                        const toneOptions = ["‡∏Å‡∏±‡∏á‡∏ß‡∏•", "‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à", "‡∏™‡∏á‡∏™‡∏±‡∏¢", "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò", "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢"];
                        const productOptions = ["‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á", "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏", "‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°"];
                        
                        return `
                            <div class="space-y-4 animate-in">
                                ${InputWrap("‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò", 
                                    createSelect('objection', 'real_reason', f.real_reason, reasonOptions)
                                )}
                                <div class="grid grid-cols-2 gap-4">
                                    ${InputWrap("‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏î‡∏¥‡∏° (1-10)", 
                                        createInput('objection', 'interest_level', f.interest_level, "5", "number", "text-center")
                                    )}
                                    ${InputWrap("‡∏à‡∏£‡∏¥‡∏ï‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                        createSelect('objection', 'disc', f.disc, {
                                            "D": "D - ‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢",
                                            "I": "I - ‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏¢", 
                                            "S": "S - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á",
                                            "C": "C - ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
                                        })
                                    )}
                                </div>
                                ${InputWrap("‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                    createSelect('objection', 'tone', f.tone, toneOptions)
                                )}
                                ${InputWrap("‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠", 
                                    createSelect('objection', 'product', f.product, productOptions)
                                )}
                                <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-100">
                                    <p class="text-xs text-amber-800">
                                        <strong>‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:</strong> AI ‡∏à‡∏∞‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏Ñ‡∏™‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${this.state.userProfile.zone} ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠
                                    </p>
                                </div>
                            </div>
                        `;
                    
                    default:
                        return `<div class="text-center text-slate-500 p-8">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>`;
                }
            }
            
            renderSetupPage() {
                const rhOptions = Object.keys(RH_DATA).map(rh => 
                    `<option value="${rh}" ${this.state.userProfile.rh === rh ? 'selected' : ''}>${rh}</option>`
                ).join('');
                
                const zoneOptions = this.state.userProfile.rh 
                    ? RH_DATA[this.state.userProfile.rh].zones.map(z => 
                        `<option value="${z}" ${this.state.userProfile.zone === z ? 'selected' : ''}>${z}</option>`
                      ).join('')
                    : '';
                
                return `
                    <div class="min-h-screen bg-gradient-to-br from-slate-900 to-slate-950 flex items-center justify-center p-4">
                        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 md:p-8">
                            <div class="flex flex-col items-center mb-8">
                                <div class="w-20 h-20 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl">
                                    ${ICONS.sparkles.replace('text-amber-500', 'text-white')}
                                </div>
                                <h1 class="text-3xl font-black text-slate-900 tracking-tight">MAMA V.2</h1>
                                <p class="text-xs bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent font-bold tracking-[0.2em] uppercase mt-2">Enhanced AI Sale Assistant</p>
                            </div>
                            
                            <div class="space-y-6">
                                <div class="text-center mb-6">
                                    <p class="text-slate-600 mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Supabase ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Key Rotation</p>
                                    <div class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full">
                                        ${ICONS.shield.replace('text-sky-500', 'text-slate-600')}
                                        <span class="text-sm font-medium text-slate-700">Secure API Management</span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">REGION (RH)</label>
                                        <select 
                                            id="rh-select"
                                            value="${this.state.userProfile.rh}" 
                                            onchange="app.setState({ userProfile: { ...app.state.userProfile, rh: this.value } })"
                                            class="w-full border-2 border-slate-100 rounded-xl p-3 focus:border-sky-500 outline-none text-base">
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å RH</option>
                                            ${rhOptions}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-600 uppercase tracking-wider mb-2">ZONE</label>
                                        <select 
                                            id="zone-select"
                                            value="${this.state.userProfile.zone}" 
                                            onchange="app.setState({ userProfile: { ...app.state.userProfile, zone: this.value } })"
                                            ${!this.state.userProfile.rh ? 'disabled' : ''}
                                            class="w-full border-2 border-slate-100 rounded-xl p-3 focus:border-sky-500 outline-none text-base ${!this.state.userProfile.rh ? 'bg-slate-50' : ''}">
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô</option>
                                            ${zoneOptions}
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="pt-4 border-t border-slate-100">
                                    <p class="text-sm text-slate-600 mb-4 text-center">
                                        ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Supabase ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö API Key Rotation ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                                    </p>
                                    <button 
                                        onclick="if(app.state.userProfile.zone) app.setState({ isSetup: true }); else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö')"
                                        class="w-full bg-gradient-to-r from-sky-600 to-indigo-600 hover:from-sky-700 hover:to-indigo-700 text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-sky-900/20 active:scale-95 transform transition-transform">
                                        ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ${ICONS.chevronRight}
                                    </button>
                                    
                                    <div class="mt-6 text-center">
                                        <a href="javascript:void(0)" onclick="app.showNonAIPopup()" class="text-sm text-slate-500 hover:text-slate-700 underline">
                                            ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Non-AI ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ API Key
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderMainPage() {
                const tabs = [
                    { id: 'ice_breaking', label: '1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à', icon: ICONS.message, desc: 'Contextual Bridge' },
                    { id: 'needs_analysis', label: '2. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', icon: ICONS.calculator, desc: 'Human Economic Value' },
                    { id: 'objection', label: '3. ‡∏ó‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á', icon: ICONS.shield, desc: 'Reframing & Empathy' },
                    { id: 'simplifier', label: '4. ‡∏¢‡πà‡∏≠‡∏¢‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå', icon: ICONS.gift, desc: 'Simplify & Compare' },
                    { id: 'matchmaker', label: '5. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå', icon: ICONS.bag, desc: 'Product Matching' },
                    { id: 'closing', label: '6. ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', icon: ICONS.file, desc: 'Closing Techniques' },
                    { id: 'prompt_designer', label: '7. Prompt Designer', icon: ICONS.terminal, desc: 'AI Prompt Engineering' },
                ];
                
                const rh = RH_DATA[this.state.userProfile.rh] || {};
                const zone = this.state.userProfile.zone;
                
                return `
                    <div class="min-h-screen flex flex-col md:flex-row bg-white">
                        <!-- Sidebar -->
                        <aside class="w-full md:w-72 bg-gradient-to-b from-slate-900 to-slate-950 text-white flex flex-col">
                            <div class="p-6 border-b border-white/10">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="w-12 h-12 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-xl flex items-center justify-center text-white">
                                        ${ICONS.sparkles.replace('text-amber-500', 'text-white')}
                                    </div>
                                    <div>
                                        <span class="font-black text-xl block leading-none">MAMA <span class="bg-gradient-to-r from-sky-400 to-indigo-400 bg-clip-text text-transparent">V.2</span></span>
                                        <span class="text-xs text-slate-400">Enhanced AI Assistant</span>
                                    </div>
                                </div>
                                <div class="text-sm opacity-75">
                                    <div class="flex items-center gap-2">
                                        ${ICONS.map}
                                        <span>${zone}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex-1 overflow-y-auto p-4 space-y-1 custom-scrollbar">
                                ${tabs.map(tab => `
                                    <button
                                        onclick="app.setState({ activeTab: '${tab.id}', aiResponse: '' })"
                                        class="w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all group text-left ${this.state.activeTab === tab.id ? 'bg-gradient-to-r from-sky-600 to-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-white/5 hover:text-white'}">
                                        ${tab.icon}
                                        <div class="flex-1">
                                            <div class="text-sm font-bold">${tab.label}</div>
                                            <div class="text-xs opacity-75">${tab.desc}</div>
                                        </div>
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div class="p-4 border-t border-white/10">
                                <button onclick="app.setState({ isSetup: false })" class="w-full flex items-center justify-center gap-2 text-slate-400 hover:text-white py-3">
                                    ${ICONS.rotate}
                                    <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span>
                                </button>
                            </div>
                        </aside>
                        
                        <!-- Main Content -->
                        <main class="flex-1 flex flex-col min-h-screen">
                            <!-- Header -->
                            <header class="bg-white border-b px-6 py-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h2 class="text-xl font-black text-slate-800">
                                            ${this.state.activeTab === 'ice_breaking' ? '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à (Ice Breaking)' : 
                                              this.state.activeTab === 'needs_analysis' ? '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (Needs Analysis)' :
                                              this.state.activeTab === 'objection' ? '‡∏ó‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á (Objection Handling)' :
                                              this.state.activeTab.replace('_', ' ')}
                                        </h2>
                                        <p class="text-sm text-slate-600 mt-1">
                                            ${this.state.activeTab === 'ice_breaking' ? 'Contextual Bridge - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏û‡∏≤‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏•‡∏∂‡∏Å‡πÜ' :
                                              this.state.activeTab === 'needs_analysis' ? 'Human Economic Value - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏û‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î' :
                                              this.state.activeTab === 'objection' ? 'Reframing & Empathy - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏à‡∏≤‡∏Å "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢" ‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á"' :
                                              '‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å AI'}
                                        </p>
                                    </div>
                                    <button 
                                        onclick="app.handleGenerate()"
                                        ${this.state.loading ? 'disabled' : ''}
                                        class="px-6 py-3 rounded-xl font-bold transition-all flex items-center gap-2 ${this.state.loading ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-sky-600 to-indigo-600 text-white hover:from-sky-700 hover:to-indigo-700 shadow-lg active:scale-95 transform transition-transform'}"
                                        style="min-width: 140px;">
                                        ${this.state.loading ? ICONS.loader : ICONS.sparkles.replace('text-amber-500', 'text-white')}
                                        <span>${this.state.loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...' : '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI'}</span>
                                    </button>
                                </div>
                            </header>
                            
                            <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
                                <!-- Left: Input Panel -->
                                <div class="w-full md:w-96 bg-slate-50 border-r overflow-y-auto p-6">
                                    <div class="mb-6">
                                        <h3 class="text-lg font-bold text-slate-800 mb-2">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                                        <p class="text-sm text-slate-600">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
                                    </div>
                                    
                                    <div id="input-section" class="mb-8">
                                        ${this.renderInputSection()}
                                    </div>
                                    
                                    <!-- Zone Insights -->
                                    <div class="bg-white rounded-xl border p-4">
                                        <div class="flex items-center gap-2 mb-3">
                                            ${ICONS.building}
                                            <h4 class="font-bold text-slate-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone}</h4>
                                        </div>
                                        <p class="text-sm text-slate-600 mb-3">${rh.dynamics || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ'}</p>
                                        <div class="space-y-2">
                                            <div class="flex items-center gap-2">
                                                ${ICONS.hospital}
                                                <span class="text-xs font-medium text-slate-700">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏´‡∏•‡∏±‡∏Å:</span>
                                            </div>
                                            <div class="flex flex-wrap gap-1.5">
                                                ${rh.hospitals ? rh.hospitals.map(h => `
                                                    <span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-lg">${h}</span>
                                                `).join('') : '<span class="text-xs text-slate-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</span>'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Right: Output Panel -->
                                <div class="flex-1 overflow-y-auto bg-white">
                                    ${this.renderOutputPanel()}
                                </div>
                            </div>
                        </main>
                    </div>
                `;
            }
            
            renderOutputPanel() {
                if (!this.state.aiResponse) {
                    return `
                        <div class="h-full flex flex-col items-center justify-center p-8 text-center">
                            <div class="w-32 h-32 bg-gradient-to-br from-slate-100 to-slate-200 rounded-full flex items-center justify-center mb-6">
                                ${ICONS.lightbulb}
                            </div>
                            <h3 class="text-2xl font-black text-slate-800 mb-4">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                            <p class="text-slate-600 max-w-md mb-8">
                                ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏°‡∏∑‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI" 
                                ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ï‡∏≤‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${this.state.userProfile.zone}
                            </p>
                            <div class="flex items-center gap-2 text-sm text-slate-500">
                                ${ICONS.zap}
                                <span>‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ Supabase API Key Rotation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£</span>
                            </div>
                        </div>
                    `;
                }
                
                // Format markdown-like response
                const formatResponse = (text) => {
                    return text
                        .replace(/### (.*?)(\n|$)/g, '<h3 class="text-xl font-black text-slate-900 mt-8 mb-4 pb-2 border-b">$1</h3>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong class="text-slate-900">$1</strong>')
                        .replace(/\n/g, '<br>')
                        .replace(/- (.*?)(<br>|$)/g, '<li class="mb-2 flex items-start"><span class="mr-2">‚Ä¢</span> <span>$1</span></li>')
                        .replace(/1\. (.*?)(<br>|$)/g, '<li class="mb-3"><span class="font-bold mr-2">1.</span> <span>$1</span></li>')
                        .replace(/2\. (.*?)(<br>|$)/g, '<li class="mb-3"><span class="font-bold mr-2">2.</span> <span>$1</span></li>')
                        .replace(/3\. (.*?)(<br>|$)/g, '<li class="mb-3"><span class="font-bold mr-2">3.</span> <span>$1</span></li>');
                };
                
                return `
                    <div class="max-w-3xl mx-auto p-6 md:p-8">
                        <div class="bg-gradient-to-br from-white to-slate-50 rounded-2xl shadow-lg overflow-hidden border border-slate-200">
                            <div class="bg-gradient-to-r from-sky-600 to-indigo-600 px-6 py-4 text-white">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                            ${ICONS.lightbulb.replace('text-amber-500', 'text-white')}
                                        </div>
                                        <div>
                                            <div class="text-sm font-bold opacity-90">AI SUGGESTION</div>
                                            <div class="text-lg font-black">${this.state.activeTab.replace('_', ' ').toUpperCase()}</div>
                                        </div>
                                    </div>
                                    <button onclick="navigator.clipboard.writeText(app.state.aiResponse); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!');" 
                                            class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-lg flex items-center justify-center transition-colors">
                                        ${ICONS.copy.replace('text-slate-500', 'text-white')}
                                    </button>
                                </div>
                            </div>
                            
                            <div class="p-6 md:p-8 markdown-content text-slate-700 leading-relaxed">
                                ${formatResponse(this.state.aiResponse)}
                            </div>
                            
                            <div class="border-t border-slate-200 p-4 bg-slate-50">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm text-slate-600">
                                        ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: <span class="font-bold">${this.state.userProfile.zone}</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="app.setState({ feedback: 'up' })" 
                                                class="w-10 h-10 rounded-full flex items-center justify-center border ${this.state.feedback === 'up' ? 'bg-emerald-500 text-white border-emerald-500' : 'bg-white text-slate-400 border-slate-300 hover:border-emerald-500 hover:text-emerald-500'}">
                                            ${ICONS.thumbsUp}
                                        </button>
                                        <button onclick="app.setState({ feedback: 'down' })" 
                                                class="w-10 h-10 rounded-full flex items-center justify-center border ${this.state.feedback === 'down' ? 'bg-rose-500 text-white border-rose-500' : 'bg-white text-slate-400 border-slate-300 hover:border-rose-500 hover:text-rose-500'}">
                                            ${ICONS.thumbsDown}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        ${this.state.error ? `
                            <div class="mt-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-600">
                                <div class="flex items-center gap-2">
                                    ${ICONS.alert}
                                    <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${this.state.error}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            render() {
                const root = document.getElementById('root');
                if (!root) {
                    console.error("Root element not found!");
                    return;
                }
                
                try {
                    const html = this.state.isSetup ? this.renderMainPage() : this.renderSetupPage();
                    root.innerHTML = html;
                    
                    console.log("Render successful!");
                } catch (error) {
                    console.error("Render error:", error);
                    root.innerHTML = `
                        <div class="min-h-screen flex items-center justify-center bg-red-50">
                            <div class="bg-white p-8 rounded-2xl shadow-lg max-w-md">
                                <h1 class="text-2xl font-bold text-red-600 mb-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h1>
                                <p class="text-slate-600 mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</p>
                                <button onclick="location.reload()" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold">
                                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            init() {
                // Load saved state
                try {
                    const savedState = localStorage.getItem('mama_v2_state');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        // Don't restore API key from localStorage for security
                        const { currentApiKey, ...rest } = parsed;
                        this.setState({ ...rest });
                    }
                } catch (e) {
                    console.log("No saved state found");
                }
                
                // Auto-save state changes
                const originalSetState = this.setState.bind(this);
                this.setState = (newState) => {
                    originalSetState(newState);
                    try {
                        const stateToSave = { ...this.state };
                        delete stateToSave.currentApiKey; // Don't save API key
                        localStorage.setItem('mama_v2_state', JSON.stringify(stateToSave));
                    } catch (e) {
                        console.log("Could not save state to localStorage");
                    }
                };
                
                this.render();
            }
        }

        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            window.app = new MAMAV2Enhanced();
            console.log("MAMA V.2 Enhanced App loaded successfully!");
        });
    </script>
</body>
</html>
