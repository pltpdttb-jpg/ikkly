<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMA V.2 - AI Sale Assistant</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', 'Noto Sans Thai', sans-serif;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        #root {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
            --dark-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        
        .animate-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        
        .custom-scrollbar:hover::-webkit-scrollbar-thumb {
            background: #94a3b8;
        }
        
        .slide-in-from-bottom {
            animation: slideInFromBottom 0.5s ease-out;
        }
        
        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        input, textarea, select {
            font-size: 16px !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #0ea5e9 !important;
            box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
        }
        
        .fixed-height {
            height: 100vh;
            height: 100dvh;
        }
        
        .overflow-container {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            transform: translateZ(0);
        }
        
        .no-scroll {
            overflow: hidden;
        }
        
        /* Icon colors - flat colors */
        .icon-primary { color: #0ea5e9; }
        .icon-secondary { color: #6366f1; }
        .icon-success { color: #10b981; }
        .icon-warning { color: #f59e0b; }
        .icon-danger { color: #ef4444; }
        .icon-purple { color: #8b5cf6; }
        .icon-pink { color: #ec4899; }
        .icon-gray { color: #6b7280; }
        
        /* Fix for mobile keyboard */
        @media (max-width: 768px) {
            .mobile-fix {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                overflow: hidden;
            }
            
            .mobile-input-container {
                padding-bottom: env(safe-area-inset-bottom);
            }
        }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root" class="fixed-height"></div>
    
    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans Thai', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#0ea5e9',
                        'secondary': '#6366f1',
                    }
                }
            }
        };

        // --- Enhanced Regional Data Schema ---
        const RH_DATA = {
            "RH1": {
                name: "RH1: ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø & ‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•",
                dynamics: "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡πÄ‡∏£‡πà‡∏á‡∏£‡∏µ‡∏ö ‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏û‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
                keywords: ["‡∏†‡∏≤‡∏©‡∏µ‡∏™‡∏±‡∏á‡∏Ñ‡∏°", "‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°", "‡∏°‡∏£‡∏î‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ"],
                hospitals: ["‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå", "‡∏™‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏ä ‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û", "‡∏û‡∏ç‡∏≤‡πÑ‡∏ó 2"],
                tone: "Professional, ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö, ‡πÄ‡∏ô‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏µ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô ‡∏£‡∏û. ‡∏£‡∏∞‡∏î‡∏±‡∏ö World Class"
            },
            "RH2": {
                name: "RH2: ‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å (EEC)",
                dynamics: "‡πÄ‡∏Ç‡∏ï‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡πÉ‡∏´‡∏°‡πà ‡∏ô‡∏¥‡∏Ñ‡∏°‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏° ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á",
                keywords: ["‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", "‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡πÑ‡∏ß", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô", "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏û‡∏±‡∏ó‡∏¢‡∏≤", "‡∏™‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏ß‡∏ä ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤", "‡∏û‡∏ç‡∏≤‡πÑ‡∏ó ‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤"],
                tone: "‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à, ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤, ‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡∏°‡∏≤",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô"
            },
            "RH3": {
                name: "RH3: ‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
                dynamics: "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤ ‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°",
                keywords: ["‡∏ö‡∏≤‡∏£‡∏°‡∏µ", "‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô", "‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏á‡πà‡∏≤‡∏á‡∏≤‡∏°", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢"],
                hospitals: ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏£‡∏≤‡∏°", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏®‡∏£‡∏µ‡∏û‡∏±‡∏í‡∏ô‡πå"],
                tone: "‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•, ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥, ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏£‡∏î‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏ß‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏£‡∏∞‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"
            },
            "RH4": {
                name: "RH4: ‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
                dynamics: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Ç‡∏¢‡∏≤‡∏¢ ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç",
                keywords: ["‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ï‡∏±‡∏ç‡∏ç‡∏π", "‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ", "‡∏ó‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏•‡∏π‡∏Å", "‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏£‡∏∞‡πÉ‡∏Ñ‡∏£"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡πÄ‡∏≠‡∏Å‡∏≠‡∏∏‡∏î‡∏£", "‡∏û‡∏£‡∏¥‡πâ‡∏ô‡∏ã‡πå ‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"],
                tone: "‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á, ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ç‡∏≤‡∏ï‡∏¥, ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏á‡πà‡∏≤‡∏¢",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡∏≤‡∏Å"
            },
            "RH5": {
                name: "RH5: ‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ",
                dynamics: "‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏á/‡∏™‡∏ß‡∏ô‡∏¢‡∏≤‡∏á/‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤",
                keywords: ["‡πÉ‡∏à‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏á", "‡∏û‡∏ß‡∏Å‡∏û‡πâ‡∏≠‡∏á", "‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á", "‡∏Å‡∏≤‡∏£‡∏±‡∏ô‡∏ï‡∏µ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ"],
                hospitals: ["‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤‡∏ô‡∏Ñ‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå (SMC)"],
                tone: "‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏ô‡πà‡∏ô, ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô, ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à, ‡πÑ‡∏°‡πà‡πÄ‡∏¢‡∏¥‡πà‡∏ô‡πÄ‡∏¢‡πâ‡∏≠",
                context: "‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≥‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠"
            }
        };

        const ZONES = {
            "RH1": ["‡∏™‡∏≤‡∏ó‡∏£-‡∏™‡∏µ‡∏•‡∏°", "‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó", "‡∏•‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≤‡∏ß", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£"],
            "RH2": ["‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏®‡∏£‡∏µ‡∏£‡∏≤‡∏ä‡∏≤-‡∏û‡∏±‡∏ó‡∏¢‡∏≤", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤"],
            "RH3": ["‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå"],
            "RH4": ["‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ"],
            "RH5": ["‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä"]
        };

        // Icon mapping - Flat color icons
        const ICONS = {
            calculator: '<i class="fas fa-calculator icon-primary"></i>',
            message: '<i class="fas fa-comment-dots icon-secondary"></i>',
            shield: '<i class="fas fa-shield-alt icon-warning"></i>',
            gift: '<i class="fas fa-gift icon-success"></i>',
            bag: '<i class="fas fa-shopping-bag icon-purple"></i>',
            file: '<i class="fas fa-file-check icon-success"></i>',
            terminal: '<i class="fas fa-terminal icon-gray"></i>',
            sparkles: '<i class="fas fa-sparkles icon-warning"></i>',
            map: '<i class="fas fa-map-marker-alt icon-danger"></i>',
            alert: '<i class="fas fa-exclamation-circle icon-danger"></i>',
            building: '<i class="fas fa-building icon-primary"></i>',
            stethoscope: '<i class="fas fa-stethoscope icon-purple"></i>',
            lightbulb: '<i class="fas fa-lightbulb icon-warning"></i>',
            zap: '<i class="fas fa-bolt icon-warning"></i>',
            trending: '<i class="fas fa-chart-line icon-success"></i>',
            copy: '<i class="fas fa-copy icon-gray"></i>',
            rotate: '<i class="fas fa-redo icon-gray"></i>',
            thumbsUp: '<i class="fas fa-thumbs-up icon-success"></i>',
            thumbsDown: '<i class="fas fa-thumbs-down icon-danger"></i>',
            share: '<i class="fas fa-share-alt icon-primary"></i>',
            save: '<i class="fas fa-save icon-primary"></i>',
            chevronRight: '<i class="fas fa-chevron-right"></i>',
            users: '<i class="fas fa-users icon-primary"></i>',
            heart: '<i class="fas fa-heart icon-danger"></i>',
            arrowRight: '<i class="fas fa-arrow-right"></i>',
            loader: '<i class="fas fa-spinner fa-spin"></i>',
            home: '<i class="fas fa-home icon-primary"></i>',
            briefcase: '<i class="fas fa-briefcase icon-warning"></i>',
            money: '<i class="fas fa-money-bill-wave icon-success"></i>',
            hospital: '<i class="fas fa-hospital icon-danger"></i>',
            clock: '<i class="fas fa-clock icon-warning"></i>',
            chartPie: '<i class="fas fa-chart-pie icon-purple"></i>'
        };

        // --- React-like Components without React ---
        class MAMAV2 {
            constructor() {
                this.state = {
                    apiKey: "",
                    isSetup: false,
                    userProfile: { agentName: "", rh: "", zone: "" },
                    activeTab: "needs_analysis",
                    loading: false,
                    aiResponse: "",
                    error: "",
                    feedback: null,
                    forms: {
                        needs_analysis: { income: "", expense: "", debt: "", dependents: "", years: "", assets: "" },
                        ice_breaking: { age: "", job: "", location: "", observation: "" },
                        objection: { type: "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠", direct_quote: "" },
                        simplifier: { plan_name: "", benefits: "", premium: "" },
                        matchmaker: { goal: "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ", budget: "" },
                        closing: { interest_point: "", last_concern: "" },
                        prompt_designer: { objective: "", target: "", tone: "Professional", details: "" }
                    }
                };
                
                // ‡πÄ‡∏Å‡πá‡∏ö element references ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô re-render
                this.inputElements = {};
                
                this.init();
            }
            
            setState(newState) {
                // Merge state ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà re-render input elements ‡∏ó‡∏µ‡πà active ‡∏≠‡∏¢‡∏π‡πà
                const oldState = { ...this.state };
                
                for (let key in newState) {
                    if (typeof this.state[key] === 'object' && this.state[key] !== null && !Array.isArray(this.state[key])) {
                        this.state[key] = { ...this.state[key], ...newState[key] };
                    } else {
                        this.state[key] = newState[key];
                    }
                }
                
                // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏Ñ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô form ‡πÑ‡∏°‡πà re-render ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤
                if (newState.forms && Object.keys(newState).length === 1) {
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô form
                    return;
                }
                
                // Re-render ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
                this.render();
            }
            
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ input ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ re-render ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤
            handleInputChange(tab, field, value) {
                this.state.forms[tab][field] = value;
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞ input element ‡∏ô‡∏±‡πâ‡∏ô‡πÜ
                const inputId = `${tab}-${field}`;
                if (this.inputElements[inputId]) {
                    this.inputElements[inputId].value = value;
                }
                
                // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô needs_analysis ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï gap ‡∏î‡πâ‡∏ß‡∏¢
                if (tab === 'needs_analysis') {
                    this.updateGapDisplay();
                }
            }
            
            calculateRealityCheck() {
                const f = this.state.forms.needs_analysis;
                const income = parseFloat(f.income) || 0;
                const expense = parseFloat(f.expense) || 0;
                const debt = parseFloat(f.debt) || 0;
                const years = parseFloat(f.years) || 1;
                const assets = parseFloat(f.assets) || 0;
                
                const totalNeed = debt + (expense * 12 * years);
                const gap = Math.max(0, totalNeed - assets);
                const months = expense > 0 ? (assets / expense) : 0;
                return { gap, months };
            }
            
            updateGapDisplay() {
                const { gap } = this.calculateRealityCheck();
                const gapElement = document.getElementById('protection-gap');
                if (gapElement) {
                    gapElement.textContent = `${gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                }
            }
            
            getPowerPrompt() {
                const rh = RH_DATA[this.state.userProfile.rh] || {};
                const zone = this.state.userProfile.zone || "";
                const commonContext = `Context: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞ MAMA AI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ${this.state.userProfile.agentName} ‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ${zone} (${rh.name || ""}). 
                Local Dynamics: ${rh.dynamics || ""}. 
                Local Keywords: ${rh.keywords ? rh.keywords.join(", ") : ""}. (AI ‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡∏Ñ‡∏≥‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ú‡∏™‡∏°‡πÉ‡∏ô‡∏ö‡∏ó‡∏û‡∏π‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1-2 ‡∏Ñ‡∏≥).
                Top Hospitals for Reference: ${rh.hospitals ? rh.hospitals.join(", ") : ""}.`;
                
                const forms = this.state.forms;
                const { gap, months } = this.calculateRealityCheck();
                
                switch (this.state.activeTab) {
                    case "needs_analysis":
                        return `${commonContext} 
                        Task: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö CFP ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Protection Gap ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ ${forms.needs_analysis.income}, ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ${forms.needs_analysis.expense}, ‡∏´‡∏ô‡∏µ‡πâ ${forms.needs_analysis.debt}.
                        Instruction: ‡∏à‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏≠‡∏î' (‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ñ‡∏∑‡∏≠ ${months.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô) ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Financial Reality Check ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö (Metaphor) ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î ${gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó ‡∏Å‡∏±‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô`;
                    
                    case "ice_breaking":
                        return `${commonContext}
                        Task: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à 3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ, ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏≠‡∏≤‡∏ä‡∏µ‡∏û, Hook ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≤‡∏¢‡∏∏ ${forms.ice_breaking.age} ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ${forms.ice_breaking.job} ‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà ${forms.ice_breaking.location}.
                        Instruction: ‡πÉ‡∏ä‡πâ 'Local Common Ground' ‡πÉ‡∏ô ${zone} (‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à, ‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏•, ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏•‡∏ô‡∏î‡πå‡∏°‡∏≤‡∏£‡πå‡∏Ñ) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏≥‡πÅ‡∏û‡∏á Tone ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô ${rh.tone || ""}`;

                    case "objection":
                        return `${commonContext}
                        Task: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ LSCPA ‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á: "${forms.objection.type}" ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: "${forms.objection.direct_quote}".
                        Instruction: ‡∏´‡πâ‡∏≤‡∏°‡πÇ‡∏ï‡πâ‡πÄ‡∏ñ‡∏µ‡∏¢‡∏á‡πÅ‡∏ï‡πà‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ 'Reframing' ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô ${zone} ‡∏°‡∏±‡∏Å‡πÄ‡∏à‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏û‡∏≠)`;

                    case "simplifier":
                        return `${commonContext}
                        Task: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Content Creator ‡∏¢‡πà‡∏≠‡∏¢‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÅ‡∏ú‡∏ô ${forms.simplifier.plan_name} ‡πÄ‡∏ö‡∏µ‡πâ‡∏¢ ${forms.simplifier.premium} ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ '3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥'.
                        Instruction: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏Å‡∏±‡∏ö '‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏û‡πÉ‡∏ô ${zone}' (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡πÅ‡∏ü‡∏£‡πâ‡∏≤‡∏ô‡∏î‡∏±‡∏á, ‡∏Ç‡πâ‡∏≤‡∏ß‡πÅ‡∏Å‡∏á, ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πã‡∏ß‡πÄ‡∏£‡∏∑‡∏≠) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å`;

                    case "matchmaker":
                        return `${commonContext}
                        Task: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ô‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Solution ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ${forms.matchmaker.goal} ‡∏á‡∏ö ${forms.matchmaker.budget}.
                        Instruction: ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÉ‡∏ô ${zone} ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ä‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≤‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£`;

                    case "closing":
                        return `${commonContext}
                        Task: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ Top Sales (MDRT) ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ä‡∏≠‡∏ö: ${forms.closing.interest_point} ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡∏Å‡∏±‡∏á‡∏ß‡∏•: ${forms.closing.last_concern}.
                        Instruction: ‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ Alternative Close ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà' (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏£‡∏û. ${rh.hospitals ? rh.hospitals[0] : ""} ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤) ‡∏£‡πà‡∏≤‡∏á‡∏ö‡∏ó‡∏û‡∏π‡∏î‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•‡πÅ‡∏ï‡πà‡∏ó‡∏£‡∏á‡∏û‡∏•‡∏±‡∏á`;

                    case "prompt_designer":
                        return `Role: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô Prompt Engineering ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÇ‡∏•‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏ó‡∏¢
                        Objective: ${forms.prompt_designer.objective}
                        Target: ${forms.prompt_designer.target}
                        Tone: ${forms.prompt_designer.tone}
                        Details: ${forms.prompt_designer.details}
                        Context: ${zone}, ${rh.name || ""}, Hospitals: ${rh.hospitals ? rh.hospitals.join(", ") : ""}
                        Task: ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö 'Master Prompt' (Structure: Context + Role + Task + Constraint) ‡∏ù‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Localized ‡∏•‡∏á‡πÑ‡∏õ
                        Output Format: 
                        1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à 
                        2. Master Prompt (‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö Code) 
                        3. ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏π‡∏ô`;

                    default: return "";
                }
            }
            
            async handleGenerate() {
                if (!this.state.apiKey && confirm("‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà API Key ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                    // ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏•‡∏≠‡∏á - ‡πÉ‡∏ä‡πâ mock responses
                    this.setState({ loading: true, aiResponse: "", error: "" });
                    
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ï‡∏≤‡∏° prompt
                    const mockResponses = {
                        needs_analysis: `### üéØ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Protection Gap\n\n‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ Protection Gap ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${this.calculateRealityCheck().gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n\n**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**\n- ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${Math.round(this.calculateRealityCheck().gap / 100000) * 100000} ‡∏ö‡∏≤‡∏ó\n- ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á\n- ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì`,
                        ice_breaking: `### üó£Ô∏è ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à 3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö\n\n**‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ:**\n"‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡∏î‡∏¥‡∏â‡∏±‡∏ô/‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å MAMA AI ‡∏î‡∏¥‡∏â‡∏±‡∏ô/‡∏ú‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô..."\n\n**‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:**\n"‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô${this.state.forms.ice_breaking.job || "‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£"} ‡∏î‡∏¥‡∏â‡∏±‡∏ô/‡∏ú‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô..."\n\n**Hook ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à:**\n"‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß?"`,
                        objection: `### üõ°Ô∏è ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ LSCPA ‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á\n\n**L - Listen (‡∏ü‡∏±‡∏á):** "‡∏ú‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏¢‡∏≠‡∏∞‡∏à‡∏£‡∏¥‡∏á‡πÜ"\n**S - Share (‡πÅ‡∏ö‡πà‡∏á‡∏õ‡∏±‡∏ô):** "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡πà‡∏≤‡∏ô‡∏Å‡πá‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô"\n**C - Clarify (‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á):** "‡πÅ‡∏ï‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô ‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏ö‡∏≤‡∏†‡∏≤‡∏£‡∏∞‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á"\n**P - Proceed (‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£):** "‡πÄ‡∏£‡∏≤‡∏°‡∏≤‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤"\n**A - Ask (‡∏ñ‡∏≤‡∏°):** "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞?"`,
                        simplifier: `### üíé 3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥\n\n1. "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡πÅ‡∏ü‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏Å‡πâ‡∏ß"\n2. "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≥ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤"\n3. "‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏±‡∏ç‡∏ç‡∏≤ ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à"`,
                        matchmaker: `### üéØ ‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì\n\n**‡πÅ‡∏ú‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå\n**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á:** ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï, ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°\n**‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô:** ${this.state.forms.matchmaker.budget || "30,000"} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ\n**‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå:** ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï 1,000,000 ‡∏ö‡∏≤‡∏ó + ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û + ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤`,
                        closing: `### ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢\n\n"‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á${this.state.forms.closing.interest_point || "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"} ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡∏ï‡∏≠‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏•‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á${this.state.forms.closing.last_concern || "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"} ‡∏ú‡∏°/‡∏î‡∏¥‡∏â‡∏±‡∏ô‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏´‡πâ..."\n\n**‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢:**\n"‡∏Ñ‡∏∏‡∏ì‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÄ‡∏ã‡πá‡∏ô‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞?"`,
                        prompt_designer: `### ü§ñ Master Prompt Design\n\n**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û\n\n**Master Prompt:**\n"‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà${this.state.userProfile.zone} ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ${this.state.forms.prompt_designer.target || "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤"} ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô${this.state.forms.prompt_designer.objective || "‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"} ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡πÄ‡∏™‡∏µ‡∏¢‡∏á${this.state.forms.prompt_designer.tone} ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•${RH_DATA[this.state.userProfile.rh]?.hospitals?.[0] || "‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≥"} ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô"\n\n**‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö:** ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡∏®‡∏∂‡∏Å‡∏©‡∏≤`
                    };
                    
                    setTimeout(() => {
                        this.setState({ 
                            aiResponse: mockResponses[this.state.activeTab] || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ",
                            loading: false 
                        });
                    }, 1000);
                    return;
                }
                
                this.setState({ loading: true, aiResponse: "", error: "" });
                
                try {
                    const prompt = this.getPowerPrompt();
                    console.log("Sending prompt:", prompt);
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.state.apiKey}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message || "API Error");
                    }
                    
                    const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å AI";
                    this.setState({ aiResponse: aiText });
                    
                } catch (err) {
                    console.error("Error:", err);
                    this.setState({ 
                        error: "API Error: " + err.message + " - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏•‡∏≠‡∏á",
                        loading: false 
                    });
                    
                    // Fallback to mock response
                    setTimeout(() => {
                        const mockResponses = {
                            needs_analysis: `### üéØ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå Protection Gap\n\n‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ Protection Gap ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${this.calculateRealityCheck().gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó\n\n**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:**\n- ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${Math.round(this.calculateRealityCheck().gap / 100000) * 100000} ‡∏ö‡∏≤‡∏ó\n- ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á\n- ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏¢‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì`,
                            ice_breaking: `### üó£Ô∏è ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à 3 ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö\n\n**‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ:**\n"‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡∏∞ ‡∏î‡∏¥‡∏â‡∏±‡∏ô/‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å MAMA AI ‡∏î‡∏¥‡∏â‡∏±‡∏ô/‡∏ú‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô..."`,
                            objection: `### üõ°Ô∏è ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ LSCPA ‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á\n\n**L - Listen (‡∏ü‡∏±‡∏á):** "‡∏ú‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏î‡∏µ‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏¢‡∏≠‡∏∞‡∏à‡∏£‡∏¥‡∏á‡πÜ"`,
                            simplifier: `### üíé 3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥\n\n1. "‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡πÅ‡∏ü‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÅ‡∏Å‡πâ‡∏ß"`,
                            matchmaker: `### üéØ ‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì\n\n**‡πÅ‡∏ú‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå`,
                            closing: `### ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢\n\n"‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô ‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á${this.state.forms.closing.interest_point || "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û"}"`,
                            prompt_designer: `### ü§ñ Master Prompt Design\n\n**‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û`
                        };
                        
                        this.setState({ 
                            aiResponse: mockResponses[this.state.activeTab] || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ",
                            loading: false 
                        });
                    }, 500);
                } finally {
                    if (!this.state.error) {
                        this.setState({ loading: false });
                    }
                }
            }
            
            renderInputSection() {
                const tab = this.state.activeTab;
                const f = this.state.forms[tab];
                
                // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á input element
                const createInput = (tabName, field, value, placeholder, type = "text", extraClass = "") => {
                    const id = `${tabName}-${field}`;
                    return `
                        <input 
                            id="${id}"
                            type="${type}" 
                            class="w-full p-2.5 border rounded-lg bg-slate-50 text-sm ${extraClass}"
                            value="${value}"
                            oninput="app.handleInputChange('${tabName}', '${field}', this.value)"
                            placeholder="${placeholder}"
                            autocomplete="off"
                        >
                    `;
                };
                
                const createTextarea = (tabName, field, value, placeholder, rows = 4) => {
                    const id = `${tabName}-${field}`;
                    return `
                        <textarea 
                            id="${id}"
                            class="w-full p-2.5 border rounded-lg bg-slate-50 text-sm resize-none"
                            rows="${rows}"
                            oninput="app.handleInputChange('${tabName}', '${field}', this.value)"
                            placeholder="${placeholder}"
                            autocomplete="off"
                        >${value}</textarea>
                    `;
                };
                
                const createSelect = (tabName, field, value, options, placeholder = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å") => {
                    const id = `${tabName}-${field}`;
                    let optionsHtml = `<option value="">${placeholder}</option>`;
                    
                    if (Array.isArray(options)) {
                        options.forEach(option => {
                            const isSelected = option === value ? 'selected' : '';
                            optionsHtml += `<option value="${option}" ${isSelected}>${option}</option>`;
                        });
                    } else if (typeof options === 'object') {
                        Object.entries(options).forEach(([key, label]) => {
                            const isSelected = key === value ? 'selected' : '';
                            optionsHtml += `<option value="${key}" ${isSelected}>${label}</option>`;
                        });
                    }
                    
                    return `
                        <select 
                            id="${id}"
                            class="w-full p-2.5 border rounded-lg bg-slate-50 text-sm"
                            onchange="app.handleInputChange('${tabName}', '${field}', this.value)"
                        >
                            ${optionsHtml}
                        </select>
                    `;
                };
                
                const InputWrap = (label, children) => `
                    <div class="mb-4">
                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 ml-1">${label}</label>
                        ${children}
                    </div>
                `;
                
                switch (tab) {
                    case "needs_analysis":
                        const { gap } = this.calculateRealityCheck();
                        return `
                            <div class="space-y-4 animate-in mobile-input-container">
                                <div class="grid grid-cols-2 gap-3">
                                    ${InputWrap("‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)", 
                                        createInput('needs_analysis', 'income', f.income, "0", "number")
                                    )}
                                    ${InputWrap("‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", 
                                        createInput('needs_analysis', 'expense', f.expense, "0", "number")
                                    )}
                                </div>
                                ${InputWrap("‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡πâ‡∏≤‡∏ô/‡∏£‡∏ñ/‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à)", 
                                    createInput('needs_analysis', 'debt', f.debt, "0", "number")
                                )}
                                <div class="grid grid-cols-2 gap-3">
                                    ${InputWrap("‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏∞", 
                                        createInput('needs_analysis', 'dependents', f.dependents, "‡∏Ñ‡∏ô", "number")
                                    )}
                                    ${InputWrap("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•", 
                                        createInput('needs_analysis', 'years', f.years, "‡∏õ‡∏µ", "number")
                                    )}
                                </div>
                                ${InputWrap("‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô)", 
                                    createInput('needs_analysis', 'assets', f.assets, "0", "number")
                                )}
                                <div class="bg-gradient-to-r from-sky-900 to-indigo-900 rounded-xl p-4 text-white shadow-lg">
                                    <div class="flex justify-between items-center text-[10px] opacity-80 mb-1">
                                        <span>ESTIMATED PROTECTION GAP</span>
                                        ${ICONS.alert}
                                    </div>
                                    <div id="protection-gap" class="text-xl font-bold">${gap.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
                                </div>
                            </div>
                        `;
                    
                    case "ice_breaking":
                        return `
                            <div class="space-y-4 animate-in mobile-input-container">
                                <div class="grid grid-cols-2 gap-3">
                                    ${InputWrap("‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", 
                                        createInput('ice_breaking', 'age', f.age, "‡πÄ‡∏ä‡πà‡∏ô 35-40 ‡∏õ‡∏µ")
                                    )}
                                    ${InputWrap("‡∏≠‡∏≤‡∏ä‡∏µ‡∏û", 
                                        createInput('ice_breaking', 'job', f.job, "‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£")
                                    )}
                                </div>
                                ${InputWrap("‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏Å‡∏±‡∏ô", 
                                    createInput('ice_breaking', 'location', f.location, "‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü‡πÉ‡∏ô‡∏ô‡∏¥‡∏Ñ‡∏°‡∏Ø")
                                )}
                                ${InputWrap("‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏´‡πá‡∏ô (Insight)", 
                                    createTextarea('ice_breaking', 'observation', f.observation, "‡πÄ‡∏ä‡πà‡∏ô ‡πÉ‡∏™‡πà‡∏™‡∏°‡∏≤‡∏£‡πå‡∏ó‡∏ß‡∏≠‡∏ó‡∏ä‡πå, ‡∏î‡∏π‡∏£‡∏µ‡∏ö‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å, ‡∏ñ‡∏∑‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏•‡∏á‡∏ó‡∏∏‡∏ô", 4)
                                )}
                            </div>
                        `;
                    
                    case "objection":
                        const objectionOptions = {
                            "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠": "‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠",
                            "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡πâ‡∏ß": "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÅ‡∏•‡πâ‡∏ß",
                            "‡∏Ç‡∏≠‡∏ñ‡∏≤‡∏°‡πÅ‡∏ü‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô": "‡∏Ç‡∏≠‡∏ñ‡∏≤‡∏°‡πÅ‡∏ü‡∏ô/‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô",
                            "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏Å‡∏á/‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏Å": "‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏Å‡∏á/‡πÄ‡∏ö‡∏¥‡∏Å‡∏¢‡∏≤‡∏Å",
                            "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö/‡∏¢‡∏±‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á": "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö/‡∏¢‡∏±‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á"
                        };
                        
                        return `
                            <div class="space-y-4 mobile-input-container">
                                ${InputWrap("‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö", 
                                    createSelect('objection', 'type', f.type, objectionOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á")
                                )}
                                ${InputWrap("‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏î‡∏¥‡∏ö‡πÜ ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (Direct Quote)", 
                                    createTextarea('objection', 'direct_quote', f.direct_quote, "‡πÄ‡∏ä‡πà‡∏ô '‡∏ô‡πâ‡∏≠‡∏á‡∏Ñ‡∏∞ ‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡∏û‡∏µ‡πà‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß‡∏à‡∏£‡∏¥‡∏á‡πÜ'", 6)
                                )}
                            </div>
                        `;
                    
                    case "simplifier":
                        return `
                            <div class="space-y-4 mobile-input-container">
                                ${InputWrap("‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô", 
                                    createInput('simplifier', 'plan_name', f.plan_name, "‡πÄ‡∏ä‡πà‡∏ô ttb Easy Care")
                                )}
                                ${InputWrap("‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)", 
                                    createInput('simplifier', 'premium', f.premium, "0", "number")
                                )}
                                ${InputWrap("‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å (‡∏£‡∏∞‡∏ö‡∏∏ 3-5 ‡∏Ç‡πâ‡∏≠)", 
                                    createTextarea('simplifier', 'benefits', f.benefits, "1. ‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô...\\n2. ‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤...", 6)
                                )}
                            </div>
                        `;
                    
                    case "matchmaker":
                        const goalOptions = {
                            "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ": "‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ",
                            "‡∏°‡∏£‡∏î‡∏Å‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô": "‡∏°‡∏£‡∏î‡∏Å‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô",
                            "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)": "‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û)",
                            "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì": "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°/‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì"
                        };
                        
                        return `
                            <div class="space-y-4 mobile-input-container">
                                ${InputWrap("‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å", 
                                    createSelect('matchmaker', 'goal', f.goal, goalOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢")
                                )}
                                ${InputWrap("‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏µ‡πà‡∏ä‡∏≥‡∏£‡∏∞‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å (‡∏ï‡πà‡∏≠‡∏õ‡∏µ)", 
                                    createInput('matchmaker', 'budget', f.budget, "‡πÄ‡∏ä‡πà‡∏ô 30,000", "number")
                                )}
                                <div class="p-4 bg-gradient-to-r from-sky-50 to-indigo-50 rounded-xl border border-sky-100 flex items-start gap-3">
                                    ${ICONS.zap}
                                    <p class="text-xs text-sky-800 leading-relaxed">MAMA ‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÅ‡∏ú‡∏ô‡πÇ‡∏î‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô <b>${this.state.userProfile.zone}</b> ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å</p>
                                </div>
                            </div>
                        `;
                    
                    case "closing":
                        return `
                            <div class="space-y-4 mobile-input-container">
                                ${InputWrap("‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡∏π‡∏™‡∏ô‡πÉ‡∏à‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", 
                                    createInput('closing', 'interest_point', f.interest_point, "‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á")
                                )}
                                ${InputWrap("‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏•‡∏±‡∏á‡πÄ‡∏•", 
                                    createTextarea('closing', 'last_concern', f.last_concern, "‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡∏±‡∏ß‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß", 6)
                                )}
                            </div>
                        `;
                    
                    case "prompt_designer":
                        const toneOptions = {
                            "Professional": "Professional",
                            "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô/‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á": "‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô/‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á",
                            "‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á": "‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏∞‡∏´‡∏ô‡∏±‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á"
                        };
                        
                        return `
                            <div class="space-y-4 mobile-input-container">
                                ${InputWrap("‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (Objective)", 
                                    createInput('prompt_designer', 'objective', f.objective, "‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå Facebook ‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û")
                                )}
                                ${InputWrap("‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Target)", 
                                    createInput('prompt_designer', 'target', f.target, "‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏ß‡∏ô‡∏¢‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà")
                                )}
                                ${InputWrap("‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£", 
                                    createSelect('prompt_designer', 'tone', f.tone, toneOptions, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå")
                                )}
                                ${InputWrap("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà", 
                                    createTextarea('prompt_designer', 'details', f.details, "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•, ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô...", 4)
                                )}
                            </div>
                        `;
                    
                    default:
                        return `<div class="text-center text-slate-500 p-8">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>`;
                }
            }
            
            renderSetupPage() {
                const rhOptions = Object.keys(RH_DATA).map(rh => 
                    `<option value="${rh}">${rh}</option>`
                ).join('');
                
                const zoneOptions = this.state.userProfile.rh 
                    ? ZONES[this.state.userProfile.rh].map(z => 
                        `<option value="${z}">${z}</option>`
                      ).join('')
                    : '';
                
                return `
                    <div class="fixed-height bg-gradient-to-br from-slate-900 to-slate-950 flex items-center justify-center p-4 overflow-container">
                        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-6 md:p-8 overflow-hidden relative">
                            <div class="absolute top-0 right-0 p-4 opacity-5">
                                ${ICONS.sparkles.replace('icon-warning', '').replace('fa-sparkles', 'fa-star')}
                            </div>
                            
                            <div class="flex flex-col items-center mb-6 relative">
                                <div class="w-16 h-16 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl">
                                    ${ICONS.sparkles.replace('icon-warning', 'text-white')}
                                </div>
                                <h1 class="text-2xl md:text-3xl font-black text-slate-900 tracking-tight">MAMA V.2</h1>
                                <p class="text-[10px] bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent font-bold tracking-[0.2em] uppercase mt-1">AI Sale Assistant</p>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 ml-1">API KEY (Optional)</label>
                                    <input type="password" 
                                        id="api-key-input"
                                        value="${this.state.apiKey}" 
                                        oninput="app.setState({ apiKey: this.value })"
                                        placeholder="Gemini API Key..." 
                                        class="w-full border-2 border-slate-100 rounded-xl p-3 focus:border-sky-500 outline-none transition-all text-base">
                                    <p class="text-xs text-slate-500 mt-1">(‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ API Key ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Demo ‡πÑ‡∏î‡πâ)</p>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 ml-1">AGENT NAME</label>
                                    <input type="text" 
                                        id="agent-name-input"
                                        value="${this.state.userProfile.agentName}" 
                                        oninput="app.setState({ userProfile: { ...app.state.userProfile, agentName: this.value } })"
                                        placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô..." 
                                        class="w-full border-2 border-slate-100 rounded-xl p-3 focus:border-sky-500 outline-none transition-all text-base">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 ml-1">REGION (RH)</label>
                                        <select 
                                            id="rh-select"
                                            value="${this.state.userProfile.rh}" 
                                            onchange="app.setState({ userProfile: { ...app.state.userProfile, rh: this.value, zone: '' } })"
                                            class="w-full border-2 border-slate-100 rounded-xl p-3 focus:border-sky-500 outline-none text-base">
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å RH</option>
                                            ${rhOptions}
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 ml-1">ZONE</label>
                                        <select 
                                            id="zone-select"
                                            value="${this.state.userProfile.zone}" 
                                            onchange="app.setState({ userProfile: { ...app.state.userProfile, zone: this.value } })"
                                            ${!this.state.userProfile.rh ? 'disabled' : ''}
                                            class="w-full border-2 border-slate-100 rounded-xl p-3 focus:border-sky-500 outline-none text-base ${!this.state.userProfile.rh ? 'bg-slate-50' : ''}">
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô</option>
                                            ${zoneOptions}
                                        </select>
                                    </div>
                                </div>
                                
                                <button 
                                    onclick="if(app.state.userProfile.agentName && app.state.userProfile.zone) app.setState({ isSetup: true }); else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö')"
                                    class="w-full bg-gradient-to-r from-sky-600 to-indigo-600 hover:from-sky-700 hover:to-indigo-700 text-white font-bold py-4 rounded-xl transition-all mt-4 flex items-center justify-center gap-2 shadow-lg shadow-sky-900/20 active:scale-95 transform transition-transform">
                                    Start Copilot ${ICONS.chevronRight}
                                </button>
                                
                                <p class="text-xs text-center text-slate-500 mt-4">
                                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API Key (Demo Mode)
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderMainPage() {
                const tabs = [
                    { id: 'needs_analysis', label: '1. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£', icon: ICONS.calculator },
                    { id: 'ice_breaking', label: '2. ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏à', icon: ICONS.message },
                    { id: 'objection', label: '3. ‡∏ó‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡πÇ‡∏ï‡πâ‡πÅ‡∏¢‡πâ‡∏á', icon: ICONS.shield },
                    { id: 'simplifier', label: '4. ‡∏¢‡πà‡∏≠‡∏¢‡∏ú‡∏•‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå', icon: ICONS.gift },
                    { id: 'matchmaker', label: '5. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå', icon: ICONS.bag },
                    { id: 'closing', label: '6. ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢', icon: ICONS.file },
                    { id: 'prompt_designer', label: '7. Prompt Designer', icon: ICONS.terminal },
                ];
                
                const rh = RH_DATA[this.state.userProfile.rh] || {};
                const zone = this.state.userProfile.zone;
                
                return `
                    <div class="fixed-height flex flex-col md:flex-row overflow-hidden">
                        <!-- Sidebar -->
                        <aside class="w-full md:w-72 bg-gradient-to-b from-slate-900 to-slate-950 text-white flex flex-col flex-shrink-0 z-30 shadow-2xl">
                            <div class="p-4 md:p-6 border-b border-white/5 flex items-center gap-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-sky-500 to-indigo-600 rounded-xl flex items-center justify-center text-white">
                                    ${ICONS.sparkles.replace('icon-warning', 'text-white')}
                                </div>
                                <div>
                                    <span class="font-black text-xl block leading-none">MAMA <span class="bg-gradient-to-r from-sky-400 to-indigo-400 bg-clip-text text-transparent">V.2</span></span>
                                    <span class="text-[8px] text-slate-500 font-bold tracking-[0.2em]">PRU ACADEMY [ttb]</span>
                                </div>
                            </div>
                            
                            <div class="flex-1 overflow-y-auto p-3 md:p-4 space-y-1.5 custom-scrollbar">
                                ${tabs.map(tab => `
                                    <button
                                        onclick="app.setState({ activeTab: '${tab.id}', aiResponse: '' })"
                                        class="w-full flex items-center gap-3 px-4 py-3.5 rounded-2xl transition-all group ${this.state.activeTab === tab.id ? 'bg-gradient-to-r from-sky-600 to-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:bg-white/5 hover:text-white'}">
                                        ${tab.icon}
                                        <span class="text-[13px] font-bold">${tab.label}</span>
                                    </button>
                                `).join('')}
                            </div>
                            
                            <div class="p-4 bg-black/20 border-t border-white/5">
                                <div class="bg-slate-800/50 rounded-2xl p-4 relative overflow-hidden">
                                    <div class="text-[10px] text-slate-500 font-bold mb-2 flex items-center gap-1 uppercase">
                                        ${ICONS.map} ${zone}
                                    </div>
                                    <div class="text-xs font-bold mb-1 truncate">${rh.name || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ'}</div>
                                    <div class="text-[10px] text-slate-400 italic">"${rh.tone || '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î'}"</div>
                                    <button onclick="app.setState({ isSetup: false })" class="absolute top-2 right-2 text-slate-600 hover:text-sky-400">
                                        ${ICONS.rotate}
                                    </button>
                                </div>
                            </div>
                        </aside>
                        
                        <!-- Main Content -->
                        <main class="flex-1 flex flex-col overflow-hidden relative">
                            <!-- Header -->
                            <header class="bg-white px-4 md:px-8 py-4 md:py-5 border-b flex justify-between items-center z-10">
                                <div>
                                    <h2 class="text-lg md:text-xl font-black text-slate-800 flex items-center gap-2">
                                        ${this.state.activeTab.replace('_', ' ').toUpperCase()}
                                    </h2>
                                    <div class="flex gap-2 mt-1">
                                        ${rh.keywords ? rh.keywords.slice(0, 2).map(k => `
                                            <span class="text-[9px] bg-slate-100 text-slate-500 px-2 py-0.5 rounded-full font-bold">#${k}</span>
                                        `).join('') : ''}
                                    </div>
                                </div>
                                <button 
                                    onclick="app.handleGenerate()"
                                    ${this.state.loading ? 'disabled' : ''}
                                    class="px-4 md:px-8 py-2 md:py-3 rounded-xl font-black transition-all flex items-center gap-2 shadow-xl ${this.state.loading ? 'bg-slate-100 text-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-sky-600 to-indigo-600 text-white hover:from-sky-700 hover:to-indigo-700 shadow-sky-900/10 active:scale-95 transform transition-transform'}"
                                    style="min-width: 120px;">
                                    ${this.state.loading ? ICONS.loader : ICONS.sparkles.replace('icon-warning', 'text-white')}
                                    <span class="hidden md:inline">${this.state.loading ? 'ANALYZING...' : 'AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå'}</span>
                                    <span class="md:hidden">${this.state.loading ? '...' : 'AI'}</span>
                                </button>
                            </header>
                            
                            <div class="flex-1 flex overflow-hidden">
                                <!-- Left: Input Panel -->
                                <div class="w-full md:w-80 bg-white border-r overflow-y-auto p-4 md:p-6 flex-shrink-0 custom-scrollbar mobile-input-container">
                                    <div class="mb-6 flex items-center justify-between">
                                        <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Client Inputs</h4>
                                        ${ICONS.trending}
                                    </div>
                                    <div id="input-section">
                                        ${this.renderInputSection()}
                                    </div>
                                    
                                    <!-- Region Insights -->
                                    <div class="mt-8 pt-8 border-t space-y-4">
                                        <div class="flex items-center gap-2 bg-gradient-to-r from-sky-600 to-indigo-600 bg-clip-text text-transparent">
                                            ${ICONS.building}
                                            <span class="text-[10px] font-black uppercase tracking-wider">Local Insight</span>
                                        </div>
                                        <div class="p-4 bg-slate-50 rounded-2xl border">
                                            <p class="text-xs text-slate-600 leading-relaxed italic">"${rh.dynamics || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ'}"</p>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                                ${ICONS.stethoscope}
                                                <span class="text-[10px] font-black uppercase tracking-wider">Top Hospitals</span>
                                            </div>
                                            <div class="flex flex-wrap gap-1.5">
                                                ${rh.hospitals ? rh.hospitals.map(h => `
                                                    <span class="text-[9px] bg-white border px-2 py-1 rounded-lg text-slate-500 font-bold">${h}</span>
                                                `).join('') : '<span class="text-[9px] text-slate-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ</span>'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Right: Output Panel -->
                                <div class="flex-1 bg-gradient-to-br from-slate-50 to-white overflow-y-auto custom-scrollbar relative">
                                    ${this.renderOutputPanel()}
                                </div>
                            </div>
                        </main>
                    </div>
                `;
            }
            
            renderOutputPanel() {
                if (!this.state.aiResponse) {
                    return `
                        <div class="h-full flex flex-col items-center justify-center opacity-20 select-none px-6 md:px-12 text-center py-12">
                            <div class="w-24 h-24 md:w-32 md:h-32 bg-gradient-to-br from-slate-200 to-slate-300 rounded-full flex items-center justify-center mb-6 shadow-inner">
                                ${ICONS.sparkles.replace('icon-warning', 'text-slate-400')}
                            </div>
                            <h3 class="text-xl md:text-3xl font-black tracking-tight bg-gradient-to-r from-slate-400 to-slate-600 bg-clip-text text-transparent">MAMA READY</h3>
                            <p class="mt-2 text-slate-500 max-w-sm text-sm md:text-base">
                                ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Input ‡∏ó‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö MDRT
                            </p>
                            ${this.state.error ? `
                                <div class="mt-8 p-4 bg-red-50 text-red-600 border border-red-200 rounded-2xl text-xs font-bold w-full max-w-md">
                                    ${this.state.error}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
                
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö markdown ‡πÄ‡∏õ‡πá‡∏ô HTML ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢
                const formatResponse = (text) => {
                    return text
                        .replace(/\n\n/g, '<br><br>')
                        .replace(/\n/g, '<br>')
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>')
                        .replace(/### (.*?)(<br>|$)/g, '<h3 class="text-lg font-black text-slate-900 mt-6 mb-3 border-l-4 border-sky-500 pl-4">$1</h3>')
                        .replace(/- (.*?)(<br>|$)/g, '<li class="ml-4 mb-2">‚Ä¢ $1</li>')
                        .replace(/`(.*?)`/g, '<code class="bg-slate-100 px-1 py-0.5 rounded">$1</code>');
                };
                
                return `
                    <div class="max-w-3xl mx-auto p-4 md:p-8 lg:p-12 pb-20 md:pb-32 slide-in-from-bottom overflow-container">
                        <!-- Result Wrapper -->
                        <div class="bg-white rounded-2xl md:rounded-[2rem] shadow-2xl shadow-slate-200 overflow-hidden border border-white">
                            <!-- Result Header -->
                            <div class="bg-gradient-to-r from-sky-600 to-indigo-600 px-6 md:px-10 py-4 md:py-6 text-white flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 md:w-10 md:h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                                        ${ICONS.lightbulb.replace('icon-warning', 'text-white')}
                                    </div>
                                    <div>
                                        <div class="text-[10px] font-bold text-sky-300 uppercase tracking-[0.2em]">AI SUGGESTION</div>
                                        <div class="text-sm font-bold opacity-90">${this.state.activeTab.replace('_', ' ').toUpperCase()}</div>
                                    </div>
                                </div>
                                <button onclick="navigator.clipboard.writeText('${this.state.aiResponse.replace(/'/g, "\\'")}'); alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏á Clipboard ‡πÅ‡∏•‡πâ‡∏ß');" class="w-8 h-8 md:w-10 md:h-10 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center transition-colors backdrop-blur-sm">
                                    ${ICONS.copy.replace('icon-gray', 'text-white')}
                                </button>
                            </div>
                            
                            <!-- Result Content -->
                            <div class="p-6 md:p-10 text-slate-700 leading-relaxed text-sm md:text-base overflow-wrap-break">
                                ${formatResponse(this.state.aiResponse)}
                            </div>
                            
                            <!-- Rating -->
                            <div class="bg-slate-50 p-4 md:p-6 border-t flex justify-center items-center gap-4 md:gap-6">
                                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Helpful?</span>
                                <div class="flex gap-4">
                                    <button onclick="app.setState({ feedback: 'up' })" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center border transition-all ${this.state.feedback === 'up' ? 'bg-gradient-to-br from-emerald-500 to-green-500 text-white border-emerald-500' : 'bg-white text-slate-300 hover:text-emerald-500'}">
                                        ${ICONS.thumbsUp}
                                    </button>
                                    <button onclick="app.setState({ feedback: 'down' })" class="w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center border transition-all ${this.state.feedback === 'down' ? 'bg-gradient-to-br from-rose-500 to-pink-500 text-white border-rose-500' : 'bg-white text-slate-300 hover:text-rose-500'}">
                                        ${ICONS.thumbsDown}
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Footer Buttons -->
                        <div class="mt-6 md:mt-8 flex flex-wrap justify-center gap-3">
                            <button class="bg-white border text-slate-600 px-4 md:px-6 py-2 md:py-3 rounded-xl text-xs font-bold hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                                ${ICONS.share} <span class="hidden md:inline">‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Line</span>
                            </button>
                            <button class="bg-white border text-slate-600 px-4 md:px-6 py-2 md:py-3 rounded-xl text-xs font-bold hover:bg-slate-50 flex items-center gap-2 shadow-sm">
                                ${ICONS.save} <span class="hidden md:inline">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ñ‡∏™</span>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            render() {
                const root = document.getElementById('root');
                if (!root) {
                    console.error("Root element not found!");
                    return;
                }
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ input elements ‡∏Å‡πà‡∏≠‡∏ô re-render
                this.saveInputValues();
                
                try {
                    const html = this.state.isSetup ? this.renderMainPage() : this.renderSetupPage();
                    root.innerHTML = html;
                    
                    // Restore input values ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö references
                    this.restoreInputValues();
                    
                    console.log("Render successful!");
                } catch (error) {
                    console.error("Render error:", error);
                    root.innerHTML = `
                        <div class="fixed-height flex items-center justify-center bg-red-50">
                            <div class="bg-white p-8 rounded-2xl shadow-lg max-w-md">
                                <h1 class="text-2xl font-bold text-red-600 mb-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h1>
                                <p class="text-slate-600 mb-4">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö</p>
                                <button onclick="location.reload()" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold">
                                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                                </button>
                            </div>
                        </div>
                    `;
                }
            }
            
            saveInputValues() {
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input elements ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                for (const id in this.inputElements) {
                    if (this.inputElements[id] && this.inputElements[id].value !== undefined) {
                        const [tab, field] = id.split('-');
                        if (tab && field && this.state.forms[tab]) {
                            this.state.forms[tab][field] = this.inputElements[id].value;
                        }
                    }
                }
            }
            
            restoreInputValues() {
                // Restore input values ‡∏à‡∏≤‡∏Å state
                this.inputElements = {};
                
                for (const tab in this.state.forms) {
                    for (const field in this.state.forms[tab]) {
                        const id = `${tab}-${field}`;
                        const element = document.getElementById(id);
                        if (element) {
                            element.value = this.state.forms[tab][field];
                            this.inputElements[id] = element;
                        }
                    }
                }
            }
            
            init() {
                // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ state ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                try {
                    const savedState = localStorage.getItem('mama_state');
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        // ‡πÑ‡∏°‡πà restore api key ‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                        const { apiKey, ...rest } = parsed;
                        this.setState({ ...rest });
                    }
                } catch (e) {
                    console.log("No saved state found");
                }
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å state ‡∏•‡∏á localStorage ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô apiKey)
                const originalSetState = this.setState.bind(this);
                this.setState = (newState) => {
                    originalSetState(newState);
                    try {
                        // ‡πÑ‡∏°‡πà save apiKey ‡∏•‡∏á localStorage
                        const stateToSave = { ...this.state };
                        delete stateToSave.apiKey;
                        localStorage.setItem('mama_state', JSON.stringify(stateToSave));
                    } catch (e) {
                        console.log("Could not save state to localStorage");
                    }
                };
                
                // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ scroll ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
                document.addEventListener('touchstart', function(e) {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                        e.target.focus();
                    }
                }, { passive: true });
                
                this.render();
            }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß
        document.addEventListener('DOMContentLoaded', function() {
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
            window.app = new MAMAV2();
            console.log("MAMA V.2 App loaded successfully!");
            
            // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ re-render ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå
            document.addEventListener('input', function(e) {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    e.stopPropagation();
                }
            }, true);
            
            // Fix for iOS keyboard
            if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
                document.addEventListener('focusin', function() {
                    setTimeout(function() {
                        window.scrollTo(0, 0);
                        document.body.scrollTop = 0;
                    }, 100);
                });
            }
        });
    </script>
</body>
</html>
